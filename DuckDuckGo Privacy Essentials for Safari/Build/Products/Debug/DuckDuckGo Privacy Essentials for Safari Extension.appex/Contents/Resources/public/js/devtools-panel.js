(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";

var _chrome$devtools, _chrome$devtools$insp;

var table = document.querySelector('#request-table');
var clearButton = document.getElementById('clear');
var refreshButton = document.getElementById('refresh');
var protectionButton = document.getElementById('protection');
var tabPicker = document.getElementById('tab-picker');
var tdsOption = document.getElementById('tds');
var displayFilters = document.querySelectorAll('#table-filter input');
var tabId = ((_chrome$devtools = chrome.devtools) === null || _chrome$devtools === void 0 ? void 0 : (_chrome$devtools$insp = _chrome$devtools.inspectedWindow) === null || _chrome$devtools$insp === void 0 ? void 0 : _chrome$devtools$insp.tabId) || parseInt(0 + new URL(document.location.href).searchParams.get('tabId'));
var port = chrome.runtime.connect(); // fetch the list of configurable features from the config and create toggles for them.

var loadConfigurableFeatures = new Promise(function (resolve) {
  chrome.runtime.sendMessage({
    getListContents: 'config'
  }, function (_ref) {
    var config = _ref.data;
    var features = Object.keys(config.features);
    features.forEach(function (feature) {
      var btn = document.createElement('button');
      btn.id = feature;
      btn.innerText = "".concat(feature, ": ???");
      document.querySelector('#protections').appendChild(btn);
      btn.addEventListener('click', function () {
        port.postMessage({
          action: "toggle".concat(feature),
          tabId: tabId
        });
      });
    });
    resolve(features);
  });
});
var actionIcons = {
  block: '🚫',
  redirect: '➡️',
  ignore: '⚠️'
};
var actionHandlers = {
  tracker: function tracker(m) {
    var _m$message = m.message,
        tracker = _m$message.tracker,
        url = _m$message.url,
        requestData = _m$message.requestData,
        siteUrl = _m$message.siteUrl;
    var row = document.getElementById('request-row').content.firstElementChild.cloneNode(true);
    var cells = row.querySelectorAll('td');
    var toggleLink = row.querySelector('.block-toggle');
    toggleLink.href = '';

    if (tracker.action === 'block') {
      toggleLink.innerText = 'I';
    } else {
      toggleLink.innerText = 'B';
    }

    toggleLink.addEventListener('click', function (ev) {
      ev.preventDefault();
      port.postMessage({
        action: toggleLink.innerText,
        tabId: tabId,
        tracker: tracker,
        requestData: requestData,
        siteUrl: siteUrl
      });
      row.classList.remove(tracker.action);
      row.classList.add(toggleLink.innerText === 'I' ? 'ignore' : 'block');
    });
    [url, "".concat(actionIcons[tracker.action], " ").concat(tracker.action, " (").concat(tracker.reason, ")"), tracker.fullTrackerDomain, requestData.type].forEach(function (text, i) {
      cells[i + 1].innerText = text;
    });
    row.classList.add(tracker.action);
    table.appendChild(row);
  },
  tabChange: function tabChange(m) {
    var _tab$site, _tab$site2;

    var tab = m.message;
    protectionButton.innerText = "Protection: ".concat((_tab$site = tab.site) !== null && _tab$site !== void 0 && _tab$site.whitelisted || (_tab$site2 = tab.site) !== null && _tab$site2 !== void 0 && _tab$site2.isBroken ? 'OFF' : 'ON');
    loadConfigurableFeatures.then(function (features) {
      features.forEach(function (feature) {
        var _tab$site3;

        document.getElementById(feature).innerText = "".concat(feature, ": ").concat((_tab$site3 = tab.site) !== null && _tab$site3 !== void 0 && _tab$site3.brokenFeatures.includes(feature) ? 'OFF' : 'ON');
      });
    });
  },
  cookie: function cookie(m) {
    var _m$message2 = m.message,
        action = _m$message2.action,
        kind = _m$message2.kind,
        url = _m$message2.url,
        requestId = _m$message2.requestId,
        type = _m$message2.type;
    var rowId = "request-".concat(requestId);

    if (document.getElementById(rowId) !== null) {
      var row = document.getElementById(rowId);
      var cells = row.querySelectorAll('td');
      row.classList.add(kind);
      cells[3].textContent = "".concat(cells[3].textContent, ", ").concat(kind);
    } else {
      var _row = document.getElementById('cookie-row').content.firstElementChild.cloneNode(true);

      _row.id = rowId;

      var _cells = _row.querySelectorAll('td');

      var cleanUrl = new URL(url);
      cleanUrl.search = '';
      cleanUrl.hash = '';
      _cells[1].textContent = cleanUrl.href;
      _cells[2].textContent = "\uD83C\uDF6A ".concat(action);
      _cells[3].textContent = kind;
      _cells[4].textContent = type;

      _row.classList.add(kind);

      table.appendChild(_row);
    }
  },
  jscookie: function jscookie(m) {
    var _m$message3 = m.message,
        documentUrl = _m$message3.documentUrl,
        action = _m$message3.action,
        reason = _m$message3.reason,
        value = _m$message3.value,
        scriptOrigins = _m$message3.scriptOrigins;
    var row = document.getElementById('cookie-row').content.firstElementChild.cloneNode(true);
    var cells = row.querySelectorAll('td');
    cells[1].textContent = documentUrl;
    cells[2].textContent = "JS\uD83C\uDF6A ".concat(action, " (").concat(reason, ")");
    cells[3].textContent = scriptOrigins.join(',');
    cells[4].textContent = value.split(';')[0];
    row.classList.add('jscookie');
    table.appendChild(row);
  },
  fingerprintingCanvas: function fingerprintingCanvas(m) {
    var _m$message4 = m.message,
        documentUrl = _m$message4.documentUrl,
        action = _m$message4.action,
        kind = _m$message4.kind,
        stack = _m$message4.stack,
        args = _m$message4.args;
    var row = document.getElementById('cookie-row').content.firstElementChild.cloneNode(true);
    var cells = row.querySelectorAll('td');
    cells[1].textContent = documentUrl;
    cells[2].textContent = "Canvas ".concat(action);
    var argsOut = JSON.parse(args).join(', ');
    cells[3].setAttribute('colspan', 2);
    cells[4].remove();
    var lines = stack.split('\n');
    lines.shift();
    cells[3].textContent = "".concat(kind, "(").concat(argsOut, ")");
    var details = document.createElement('details');
    var summary = document.createElement('summary');
    summary.textContent = 'Call stack';
    details.appendChild(summary);
    details.appendChild(document.createTextNode(lines.join('\n')));
    cells[3].appendChild(details);
    row.classList.add('canvas');
    table.appendChild(row);
  }
};

function shouldShowRow(className) {
  var filter = document.getElementById("display-".concat(className));
  return !filter || filter.checked;
}

function setRowVisible(row) {
  row.hidden = !shouldShowRow(row.classList[0]);
}

port.onMessage.addListener(function (message) {
  var m = JSON.parse(message);

  if (m.tabId === tabId) {
    if (actionHandlers[m.action]) {
      actionHandlers[m.action](m);
    }

    if (document.querySelector('tbody').lastChild) {
      setRowVisible(document.querySelector('tbody').lastChild);
    }
  }
});

function updateTabSelector() {
  chrome.tabs.query({}, function (tabs) {
    while (tabPicker.firstChild !== null) {
      tabPicker.removeChild(tabPicker.firstChild);
    }

    var selectTabOption = document.createElement('option');
    selectTabOption.value = '';
    selectTabOption.innerText = '--Select Tab--';
    tabPicker.appendChild(selectTabOption);
    tabs.forEach(function (tab) {
      if (tab.url.startsWith('http')) {
        var elem = document.createElement('option');
        elem.value = tab.id;
        elem.innerText = tab.title;

        if (tab.id === tabId) {
          elem.setAttribute('selected', true);
        }

        tabPicker.appendChild(elem);
      }
    });
  });
}

if (!chrome.devtools) {
  updateTabSelector();
  chrome.tabs.onUpdated.addListener(updateTabSelector);
  tabPicker.addEventListener('change', function () {
    tabId = parseInt(tabPicker.selectedOptions[0].value);
    clear();
    port.postMessage({
      action: 'setTab',
      tabId: tabId
    });
  });
} else {
  tabPicker.hidden = true;
}

if (tabId) {
  port.postMessage({
    action: 'setTab',
    tabId: tabId
  });
}

function clear() {
  while (table.lastChild) {
    table.removeChild(table.lastChild);
  }
} // listeners for buttons and toggles


clearButton.addEventListener('click', clear);
refreshButton.addEventListener('click', function () {
  clear();

  if (chrome.devtools) {
    chrome.devtools.inspectedWindow.eval('window.location.reload();');
  } else {
    chrome.tabs.reload(tabId);
  }
});
protectionButton.addEventListener('click', function () {
  port.postMessage({
    action: 'toggleProtection',
    tabId: tabId
  });
});
chrome.runtime.sendMessage({
  getSetting: {
    name: 'tds-channel'
  }
}, function (result) {
  console.log('setting', result);
  var active = tdsOption.querySelector("[value=".concat(result));

  if (active) {
    active.setAttribute('selected', true);
  }
});
tdsOption.addEventListener('change', function (e) {
  chrome.runtime.sendMessage({
    updateSetting: {
      name: 'tds-channel',
      value: tdsOption.selectedOptions[0].value
    }
  }, function () {
    chrome.runtime.sendMessage({
      reloadList: 'tds'
    });
  });
});
displayFilters.forEach(function (input) {
  input.addEventListener('change', function () {
    document.querySelectorAll('tr').forEach(setRowVisible);
  });
});

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzaGFyZWQvanMvZGV2dG9vbHMvcGFuZWwuZXM2LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7OztBQ0FBLElBQU0sS0FBSyxHQUFHLFFBQVEsQ0FBQyxhQUFULENBQXVCLGdCQUF2QixDQUFkO0FBQ0EsSUFBTSxXQUFXLEdBQUcsUUFBUSxDQUFDLGNBQVQsQ0FBd0IsT0FBeEIsQ0FBcEI7QUFDQSxJQUFNLGFBQWEsR0FBRyxRQUFRLENBQUMsY0FBVCxDQUF3QixTQUF4QixDQUF0QjtBQUNBLElBQU0sZ0JBQWdCLEdBQUcsUUFBUSxDQUFDLGNBQVQsQ0FBd0IsWUFBeEIsQ0FBekI7QUFDQSxJQUFNLFNBQVMsR0FBRyxRQUFRLENBQUMsY0FBVCxDQUF3QixZQUF4QixDQUFsQjtBQUNBLElBQU0sU0FBUyxHQUFHLFFBQVEsQ0FBQyxjQUFULENBQXdCLEtBQXhCLENBQWxCO0FBQ0EsSUFBTSxjQUFjLEdBQUcsUUFBUSxDQUFDLGdCQUFULENBQTBCLHFCQUExQixDQUF2QjtBQUVBLElBQUksS0FBSyxHQUFHLHFCQUFBLE1BQU0sQ0FBQyxRQUFQLCtGQUFpQixlQUFqQixnRkFBa0MsS0FBbEMsS0FBMkMsUUFBUSxDQUFDLElBQUksSUFBSSxHQUFKLENBQVEsUUFBUSxDQUFDLFFBQVQsQ0FBa0IsSUFBMUIsRUFBZ0MsWUFBaEMsQ0FBNkMsR0FBN0MsQ0FBaUQsT0FBakQsQ0FBTCxDQUEvRDtBQUNBLElBQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQyxPQUFQLENBQWUsT0FBZixFQUFiLEMsQ0FDQTs7QUFDQSxJQUFNLHdCQUF3QixHQUFHLElBQUksT0FBSixDQUFZLFVBQUMsT0FBRCxFQUFhO0FBQ3RELEVBQUEsTUFBTSxDQUFDLE9BQVAsQ0FBZSxXQUFmLENBQTJCO0FBQ3ZCLElBQUEsZUFBZSxFQUFFO0FBRE0sR0FBM0IsRUFFRyxnQkFBc0I7QUFBQSxRQUFiLE1BQWEsUUFBbkIs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QUlILENBTEQ7QUFPQSxNQUFNLENBQUMsT0FBUCxDQUFlLFdBQWYsQ0FBMkI7QUFBRSxFQUFBLFVBQVUsRUFBRTtBQUFFLElBQUEsSUFBSSxFQUFFO0FBQVI7QUFBZCxDQUEzQixFQUFvRSxVQUFDLE1BQUQsRUFBWTtBQUM1RSxFQUFBLE9BQU8sQ0FBQyxHQUFSLENBQVksU0FBWixFQUF1QixNQUF2QjtBQUNBLE1BQU0sTUFBTSxHQUFHLFNBQVMsQ0FBQyxhQUFWLGtCQUFrQyxNQUFsQyxFQUFmOztBQUNBLE1BQUksTUFBSixFQUFZO0FBQ1IsSUFBQSxNQUFNLENBQUMsWUFBUCxDQUFvQixVQUFwQixFQUFnQyxJQUFoQztBQUNIO0FBQ0osQ0FORDtBQVFBLFNBQVMsQ0FBQyxnQkFBVixDQUEyQixRQUEzQixFQUFxQyxVQUFDLENBQUQsRUFBTztBQUN4QyxFQUFBLE1BQU0sQ0FBQyxPQUFQLENBQWUsV0FBZixDQUEyQjtBQUN2QixJQUFBLGFBQWEsRUFBRTtBQUNYLE1BQUEsSUFBSSxFQUFFLGFBREs7QUFFWCxNQUFBLEtBQUssRUFBRSxTQUFTLENBQUMsZUFBVixDQUEwQixDQUExQixFQUE2QjtBQUZ6QjtBQURRLEdBQTNCLEVBS0csWUFBTTtBQUNMLElBQUEsTUFBTSxDQUFDLE9BQVAsQ0FBZSxXQUFmLENBQTJCO0FBQUUsTUFBQSxVQUFVLEVBQUU7QUFBZCxLQUEzQjtBQUNILEdBUEQ7QUFRSCxDQVREO0FBV0EsY0FBYyxDQUFDLE9BQWYsQ0FBdUIsVUFBQyxLQUFELEVBQVc7QUFDOUIsRUFBQSxLQUFLLENBQUMsZ0JBQU4sQ0FBdUIsUUFBdkIsRUFBaUMsWUFBTTtBQUNuQyxJQUFBLFFBQVEsQ0FBQyxnQkFBVCxDQUEwQixJQUExQixFQUFnQyxPQUFoQyxDQUF3QyxhQUF4QztBQUNILEdBRkQ7QUFHSCxDQUpEIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiY29uc3QgdGFibGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjcmVxdWVzdC10YWJsZScpXG5jb25zdCBjbGVhckJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjbGVhcicpXG5jb25zdCByZWZyZXNoQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlZnJlc2gnKVxuY29uc3QgcHJvdGVjdGlvbkJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm90ZWN0aW9uJylcbmNvbnN0IHRhYlBpY2tlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YWItcGlja2VyJylcbmNvbnN0IHRkc09wdGlvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0ZHMnKVxuY29uc3QgZGlzcGxheUZpbHRlcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcjdGFibGUtZmlsdGVyIGlucHV0JylcblxubGV0IHRhYklkID0gY2hyb21lLmRldnRvb2xzPy5pbnNwZWN0ZWRXaW5kb3c/LnRhYklkIHx8IHBhcnNlSW50KDAgKyBuZXcgVVJMKGRvY3VtZW50LmxvY2F0aW9uLmhyZWYpLnNlYXJjaFBhcmFtcy5nZXQoJ3RhYklkJykpXG5jb25zdCBwb3J0ID0gY2hyb21lLnJ1bnRpbWUuY29ubmVjdCgpXG4vLyBmZXRjaCB0aGUgbGlzdCBvZiBjb25maWd1cmFibGUgZmVhdHVyZXMgZnJvbSB0aGUgY29uZmlnIGFuZCBjcmVhdGUgdG9nZ2xlcyBmb3IgdGhlbS5cbmNvbnN0IGxvYWRDb25maWd1cmFibGVGZWF0dXJlcyA9IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgY2hyb21lLnJ1bnRpbWUuc2VuZE1lc3NhZ2Uoe1xuICAgICAgICBnZXRMaXN0Q29udGVudHM6ICdjb25maWcnXG4gICAgfSwgKHsgZGF0YTogY29uZmlnIH0pID0+IHtcbiAgICAgICAgY29uc3QgZmVhdHVyZXMgPSBPYmplY3Qua2V5cyhjb25maWcuZmVhdHVyZXMpXG4gICAgICAgIGZlYXR1cmVzLmZvckVhY2goKGZlYXR1cmUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpXG4gICAgICAgICAgICBidG4uaWQgPSBmZWF0dXJlXG4gICAgICAgICAgICBidG4uaW5uZXJUZXh0ID0gYCR7ZmVhdHVyZX06ID8/P2BcbiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwcm90ZWN0aW9ucycpLmFwcGVuZENoaWxkKGJ0bilcbiAgICAgICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgICAgICAgICBwb3J0LnBvc3RNZXNzYWdlKHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBgdG9nZ2xlJHtmZWF0dXJlfWAsXG4gICAgICAgICAgICAgICAgICAgIHRhYklkXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgICAgIHJlc29sdmUoZmVhdHVyZXMpXG4gICAgfSlcbn0pXG5cbmNvbnN0IGFjdGlvbkljb25zID0ge1xuICAgIGJsb2NrOiAn8J+aqycsXG4gICAgcmVkaXJlY3Q6ICfinqHvuI8nLFxuICAgIGlnbm9yZTogJ+KaoO+4jydcbn1cblxuY29uc3QgYWN0aW9uSGFuZGxlcnMgPSB7XG4gICAgdHJhY2tlcjogKG0pID0+IHtcbiAgICAgICAgY29uc3QgeyB0cmFja2VyLCB1cmwsIHJlcXVlc3REYXRhLCBzaXRlVXJsIH0gPSBtLm1lc3NhZ2VcbiAgICAgICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlcXVlc3Qtcm93JykuY29udGVudC5maXJzdEVsZW1lbnRDaGlsZC5jbG9uZU5vZGUodHJ1ZSlcbiAgICAgICAgY29uc3QgY2VsbHMgPSByb3cucXVlcnlTZWxlY3RvckFsbCgndGQnKVxuICAgICAgICBjb25zdCB0b2dnbGVMaW5rID0gcm93LnF1ZXJ5U2VsZWN0b3IoJy5ibG9jay10b2dnbGUnKVxuICAgICAgICB0b2dnbGVMaW5rLmhyZWYgPSAnJ1xuICAgICAgICBpZiAodHJhY2tlci5hY3Rpb24gPT09ICdibG9jaycpIHtcbiAgICAgICAgICAgIHRvZ2dsZUxpbmsuaW5uZXJUZXh0ID0gJ0knXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0b2dnbGVMaW5rLmlubmVyVGV4dCA9ICdCJ1xuICAgICAgICB9XG4gICAgICAgIHRvZ2dsZUxpbmsuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXYpID0+IHtcbiAgICAgICAgICAgIGV2LnByZXZlbnREZWZhdWx0KClcbiAgICAgICAgICAgIHBvcnQucG9zdE1lc3NhZ2Uoe1xuICAgICAgICAgICAgICAgIGFjdGlvbjogdG9nZ2xlTGluay5pbm5lclRleHQsXG4gICAgICAgICAgICAgICAgdGFiSWQsXG4gICAgICAgICAgICAgICAgdHJhY2tlcixcbiAgICAgICAgICAgICAgICByZXF1ZXN0RGF0YSxcbiAgICAgICAgICAgICAgICBzaXRlVXJsXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgcm93LmNsYXNzTGlzdC5yZW1vdmUodHJhY2tlci5hY3Rpb24pXG4gICAgICAgICAgICByb3cuY2xhc3NMaXN0LmFkZCh0b2dnbGVMaW5rLmlubmVyVGV4dCA9PT0gJ0knID8gJ2lnbm9yZScgOiAnYmxvY2snKVxuICAgICAgICB9KTtcbiAgICAgICAgW3VybCwgYCR7YWN0aW9uSWNvbnNbdHJhY2tlci5hY3Rpb25dfSAke3RyYWNrZXIuYWN0aW9ufSAoJHt0cmFja2VyLnJlYXNvbn0pYCwgdHJhY2tlci5mdWxsVHJhY2tlckRvbWFpbiwgcmVxdWVzdERhdGEudHlwZV0uZm9yRWFjaCgodGV4dCwgaSkgPT4ge1xuICAgICAgICAgICAgY2VsbHNbaSArIDFdLmlubmVyVGV4dCA9IHRleHRcbiAgICAgICAgfSlcbiAgICAgICAgcm93LmNsYXNzTGlzdC5hZGQodHJhY2tlci5hY3Rpb24pXG4gICAgICAgIHRhYmxlLmFwcGVuZENoaWxkKHJvdylcbiAgICB9LFxuICAgIHRhYkNoYW5nZTogKG0pID0+IHtcbiAgICAgICAgY29uc3QgdGFiID0gbS5tZXNzYWdlXG4gICAgICAgIHByb3RlY3Rpb25CdXR0b24uaW5uZXJUZXh0ID0gYFByb3RlY3Rpb246ICR7dGFiLnNpdGU/LndoaXRlbGlzdGVkIHx8IHRhYi5zaXRlPy5pc0Jyb2tlbiA/ICdPRkYnIDogJ09OJ31gXG4gICAgICAgIGxvYWRDb25maWd1cmFibGVGZWF0dXJlcy50aGVuKChmZWF0dXJlcykgPT4ge1xuICAgICAgICAgICAgZmVhdHVyZXMuZm9yRWFjaCgoZmVhdHVyZSkgPT4ge1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGZlYXR1cmUpLmlubmVyVGV4dCA9IGAke2ZlYXR1cmV9OiAke3RhYi5zaXRlPy5icm9rZW5GZWF0dXJlcy5pbmNsdWRlcyhmZWF0dXJlKSA/ICdPRkYnIDogJ09OJ31gXG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgIH0sXG4gICAgY29va2llOiAobSkgPT4ge1xuICAgICAgICBjb25zdCB7IGFjdGlvbiwga2luZCwgdXJsLCByZXF1ZXN0SWQsIHR5cGUgfSA9IG0ubWVzc2FnZVxuICAgICAgICBjb25zdCByb3dJZCA9IGByZXF1ZXN0LSR7cmVxdWVzdElkfWBcbiAgICAgICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHJvd0lkKSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQocm93SWQpXG4gICAgICAgICAgICBjb25zdCBjZWxscyA9IHJvdy5xdWVyeVNlbGVjdG9yQWxsKCd0ZCcpXG4gICAgICAgICAgICByb3cuY2xhc3NMaXN0LmFkZChraW5kKVxuICAgICAgICAgICAgY2VsbHNbM10udGV4dENvbnRlbnQgPSBgJHtjZWxsc1szXS50ZXh0Q29udGVudH0sICR7a2luZH1gXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCByb3cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29va2llLXJvdycpLmNvbnRlbnQuZmlyc3RFbGVtZW50Q2hpbGQuY2xvbmVOb2RlKHRydWUpXG4gICAgICAgICAgICByb3cuaWQgPSByb3dJZFxuICAgICAgICAgICAgY29uc3QgY2VsbHMgPSByb3cucXVlcnlTZWxlY3RvckFsbCgndGQnKVxuICAgICAgICAgICAgY29uc3QgY2xlYW5VcmwgPSBuZXcgVVJMKHVybClcbiAgICAgICAgICAgIGNsZWFuVXJsLnNlYXJjaCA9ICcnXG4gICAgICAgICAgICBjbGVhblVybC5oYXNoID0gJydcbiAgICAgICAgICAgIGNlbGxzWzFdLnRleHRDb250ZW50ID0gY2xlYW5VcmwuaHJlZlxuICAgICAgICAgICAgY2VsbHNbMl0udGV4dENvbnRlbnQgPSBg8J+NqiAke2FjdGlvbn1gXG4gICAgICAgICAgICBjZWxsc1szXS50ZXh0Q29udGVudCA9IGtpbmRcbiAgICAgICAgICAgIGNlbGxzWzRdLnRleHRDb250ZW50ID0gdHlwZVxuICAgICAgICAgICAgcm93LmNsYXNzTGlzdC5hZGQoa2luZClcbiAgICAgICAgICAgIHRhYmxlLmFwcGVuZENoaWxkKHJvdylcbiAgICAgICAgfVxuICAgIH0sXG4gICAganNjb29raWU6IChtKSA9PiB7XG4gICAgICAgIGNvbnN0IHsgZG9jdW1lbnRVcmwsIGFjdGlvbiwgcmVhc29uLCB2YWx1ZSwgc2NyaXB0T3JpZ2lucyB9ID0gbS5tZXNzYWdlXG4gICAgICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb29raWUtcm93JykuY29udGVudC5maXJzdEVsZW1lbnRDaGlsZC5jbG9uZU5vZGUodHJ1ZSlcbiAgICAgICAgY29uc3QgY2VsbHMgPSByb3cucXVlcnlTZWxlY3RvckFsbCgndGQnKVxuICAgICAgICBjZWxsc1sxXS50ZXh0Q29udGVudCA9IGRvY3VtZW50VXJsXG4gICAgICAgIGNlbGxzWzJdLnRleHRDb250ZW50ID0gYEpT8J+NqiAke2FjdGlvbn0gKCR7cmVhc29ufSlgXG4gICAgICAgIGNlbGxzWzNdLnRleHRDb250ZW50ID0gc2NyaXB0T3JpZ2lucy5qb2luKCcsJylcbiAgICAgICAgY2VsbHNbNF0udGV4dENvbnRlbnQgPSB2YWx1ZS5zcGxpdCgnOycpWzBdXG4gICAgICAgIHJvdy5jbGFzc0xpc3QuYWRkKCdqc2Nvb2tpZScpXG4gICAgICAgIHRhYmxlLmFwcGVuZENoaWxkKHJvdylcbiAgICB9LFxuICAgIGZpbmdlcnByaW50aW5nQ2FudmFzOiAobSkgPT4ge1xuICAgICAgICBjb25zdCB7IGRvY3VtZW50VXJsLCBhY3Rpb24sIGtpbmQsIHN0YWNrLCBhcmdzIH0gPSBtLm1lc3NhZ2VcbiAgICAgICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nvb2tpZS1yb3cnKS5jb250ZW50LmZpcnN0RWxlbWVudENoaWxkLmNsb25lTm9kZSh0cnVlKVxuICAgICAgICBjb25zdCBjZWxscyA9IHJvdy5xdWVyeVNlbGVjdG9yQWxsKCd0ZCcpXG4gICAgICAgIGNlbGxzWzFdLnRleHRDb250ZW50ID0gZG9jdW1lbnRVcmxcbiAgICAgICAgY2VsbHNbMl0udGV4dENvbnRlbnQgPSBgQ2FudmFzICR7YWN0aW9ufWBcbiAgICAgICAgY29uc3QgYXJnc091dCA9IEpTT04ucGFyc2UoYXJncykuam9pbignLCAnKVxuICAgICAgICBjZWxsc1szXS5zZXRBdHRyaWJ1dGUoJ2NvbHNwYW4nLCAyKVxuICAgICAgICBjZWxsc1s0XS5yZW1vdmUoKVxuICAgICAgICBjb25zdCBsaW5lcyA9IHN0YWNrLnNwbGl0KCdcXG4nKVxuICAgICAgICBsaW5lcy5zaGlmdCgpXG5cbiAgICAgICAgY2VsbHNbM10udGV4dENvbnRlbnQgPSBgJHtraW5kfSgke2FyZ3NPdXR9KWBcbiAgICAgICAgY29uc3QgZGV0YWlscyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RldGFpbHMnKVxuICAgICAgICBjb25zdCBzdW1tYXJ5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3VtbWFyeScpXG4gICAgICAgIHN1bW1hcnkudGV4dENvbnRlbnQgPSAnQ2FsbCBzdGFjaydcbiAgICAgICAgZGV0YWlscy5hcHBlbmRDaGlsZChzdW1tYXJ5KVxuICAgICAgICBkZXRhaWxzLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGxpbmVzLmpvaW4oJ1xcbicpKSlcbiAgICAgICAgY2VsbHNbM10uYXBwZW5kQ2hpbGQoZGV0YWlscylcblxuICAgICAgICByb3cuY2xhc3NMaXN0LmFkZCgnY2FudmFzJylcbiAgICAgICAgdGFibGUuYXBwZW5kQ2hpbGQocm93KVxuICAgIH1cbn1cblxuZnVuY3Rpb24gc2hvdWxkU2hvd1JvdyAoY2xhc3NOYW1lKSB7XG4gICAgY29uc3QgZmlsdGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGRpc3BsYXktJHtjbGFzc05hbWV9YClcbiAgICByZXR1cm4gIWZpbHRlciB8fCBmaWx0ZXIuY2hlY2tlZFxufVxuXG5mdW5jdGlvbiBzZXRSb3dWaXNpYmxlIChyb3cpIHtcbiAgICByb3cuaGlkZGVuID0gIXNob3VsZFNob3dSb3cocm93LmNsYXNzTGlzdFswXSlcbn1cblxucG9ydC5vbk1lc3NhZ2UuYWRkTGlzdGVuZXIoKG1lc3NhZ2UpID0+IHtcbiAgICBjb25zdCBtID0gSlNPTi5wYXJzZShtZXNzYWdlKVxuICAgIGlmIChtLnRhYklkID09PSB0YWJJZCkge1xuICAgICAgICBpZiAoYWN0aW9uSGFuZGxlcnNbbS5hY3Rpb25dKSB7XG4gICAgICAgICAgICBhY3Rpb25IYW5kbGVyc1ttLmFjdGlvbl0obSlcbiAgICAgICAgfVxuICAgICAgICBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcigndGJvZHknKS5sYXN0Q2hpbGQpIHtcbiAgICAgICAgICAgIHNldFJvd1Zpc2libGUoZG9jdW1lbnQucXVlcnlTZWxlY3RvcigndGJvZHknKS5sYXN0Q2hpbGQpXG4gICAgICAgIH1cbiAgICB9XG59KVxuXG5mdW5jdGlvbiB1cGRhdGVUYWJTZWxlY3RvciAoKSB7XG4gICAgY2hyb21lLnRhYnMucXVlcnkoe30sICh0YWJzKSA9PiB7XG4gICAgICAgIHdoaWxlICh0YWJQaWNrZXIuZmlyc3RDaGlsZCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgdGFiUGlja2VyLnJlbW92ZUNoaWxkKHRhYlBpY2tlci5maXJzdENoaWxkKVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNlbGVjdFRhYk9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpXG4gICAgICAgIHNlbGVjdFRhYk9wdGlvbi52YWx1ZSA9ICcnXG4gICAgICAgIHNlbGVjdFRhYk9wdGlvbi5pbm5lclRleHQgPSAnLS1TZWxlY3QgVGFiLS0nXG4gICAgICAgIHRhYlBpY2tlci5hcHBlbmRDaGlsZChzZWxlY3RUYWJPcHRpb24pXG4gICAgICAgIHRhYnMuZm9yRWFjaCgodGFiKSA9PiB7XG4gICAgICAgICAgICBpZiAodGFiLnVybC5zdGFydHNXaXRoKCdodHRwJykpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJylcbiAgICAgICAgICAgICAgICBlbGVtLnZhbHVlID0gdGFiLmlkXG4gICAgICAgICAgICAgICAgZWxlbS5pbm5lclRleHQgPSB0YWIudGl0bGVcbiAgICAgICAgICAgICAgICBpZiAodGFiLmlkID09PSB0YWJJZCkge1xuICAgICAgICAgICAgICAgICAgICBlbGVtLnNldEF0dHJpYnV0ZSgnc2VsZWN0ZWQnLCB0cnVlKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0YWJQaWNrZXIuYXBwZW5kQ2hpbGQoZWxlbSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICB9KVxufVxuXG5pZiAoIWNocm9tZS5kZXZ0b29scykge1xuICAgIHVwZGF0ZVRhYlNlbGVjdG9yKClcbiAgICBjaHJvbWUudGFicy5vblVwZGF0ZWQuYWRkTGlzdGVuZXIodXBkYXRlVGFiU2VsZWN0b3IpXG4gICAgdGFiUGlja2VyLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsICgpID0+IHtcbiAgICAgICAgdGFiSWQgPSBwYXJzZUludCh0YWJQaWNrZXIuc2VsZWN0ZWRPcHRpb25zWzBdLnZhbHVlKVxuICAgICAgICBjbGVhcigpXG4gICAgICAgIHBvcnQucG9zdE1lc3NhZ2UoeyBhY3Rpb246ICdzZXRUYWInLCB0YWJJZCB9KVxuICAgIH0pXG59IGVsc2Uge1xuICAgIHRhYlBpY2tlci5oaWRkZW4gPSB0cnVlXG59XG5cbmlmICh0YWJJZCkge1xuICAgIHBvcnQucG9zdE1lc3NhZ2UoeyBhY3Rpb246ICdzZXRUYWInLCB0YWJJZCB9KVxufVxuXG5mdW5jdGlvbiBjbGVhciAoKSB7XG4gICAgd2hpbGUgKHRhYmxlLmxhc3RDaGlsZCkge1xuICAgICAgICB0YWJsZS5yZW1vdmVDaGlsZCh0YWJsZS5sYXN0Q2hpbGQpXG4gICAgfVxufVxuXG4vLyBsaXN0ZW5lcnMgZm9yIGJ1dHRvbnMgYW5kIHRvZ2dsZXNcbmNsZWFyQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY2xlYXIpXG5yZWZyZXNoQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgIGNsZWFyKClcbiAgICBpZiAoY2hyb21lLmRldnRvb2xzKSB7XG4gICAgICAgIGNocm9tZS5kZXZ0b29scy5pbnNwZWN0ZWRXaW5kb3cuZXZhbCgnd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpOycpXG4gICAgfSBlbHNlIHtcbiAgICAgICAgY2hyb21lLnRhYnMucmVsb2FkKHRhYklkKVxuICAgIH1cbn0pXG5wcm90ZWN0aW9uQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgIHBvcnQucG9zdE1lc3NhZ2Uoe1xuICAgICAgICBhY3Rpb246ICd0b2dnbGVQcm90ZWN0aW9uJyxcbiAgICAgICAgdGFiSWRcbiAgICB9KVxufSlcblxuY2hyb21lLnJ1bnRpbWUuc2VuZE1lc3NhZ2UoeyBnZXRTZXR0aW5nOiB7IG5hbWU6ICd0ZHMtY2hhbm5lbCcgfSB9LCAocmVzdWx0KSA9PiB7XG4gICAgY29uc29sZS5sb2coJ3NldHRpbmcnLCByZXN1bHQpXG4gICAgY29uc3QgYWN0aXZlID0gdGRzT3B0aW9uLnF1ZXJ5U2VsZWN0b3IoYFt2YWx1ZT0ke3Jlc3VsdH1gKVxuICAgIGlmIChhY3RpdmUpIHtcbiAgICAgICAgYWN0aXZlLnNldEF0dHJpYnV0ZSgnc2VsZWN0ZWQnLCB0cnVlKVxuICAgIH1cbn0pXG5cbnRkc09wdGlvbi5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZSkgPT4ge1xuICAgIGNocm9tZS5ydW50aW1lLnNlbmRNZXNzYWdlKHtcbiAgICAgICAgdXBkYXRlU2V0dGluZzoge1xuICAgICAgICAgICAgbmFtZTogJ3Rkcy1jaGFubmVsJyxcbiAgICAgICAgICAgIHZhbHVlOiB0ZHNPcHRpb24uc2VsZWN0ZWRPcHRpb25zWzBdLnZhbHVlXG4gICAgICAgIH1cbiAgICB9LCAoKSA9PiB7XG4gICAgICAgIGNocm9tZS5ydW50aW1lLnNlbmRNZXNzYWdlKHsgcmVsb2FkTGlzdDogJ3RkcycgfSlcbiAgICB9KVxufSlcblxuZGlzcGxheUZpbHRlcnMuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoKSA9PiB7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ3RyJykuZm9yRWFjaChzZXRSb3dWaXNpYmxlKVxuICAgIH0pXG59KVxuIl19
